{% load static wagtailcore_tags wagtailimages_tags wagtailuserbar menu_tags home_tags %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
{% get_language_info for LANGUAGE_CODE as lang %}
{% get_available_languages as LANGUAGES %}
{% get_language_info_list for LANGUAGES as languages %}
{% get_current_language as LANGUAGE_CODE %}

<footer class='footer-main'>
    {% flat_menu LANGUAGE_CODE|add:'_menu_live' template="nav_bar.html" %}
    <div id="menu">
        <div class="footer-head">
            {% include "header.html" %}
        </div>
        <div class='footer'>
            <div class="section-container">
                {% render_top_level_sections %}
                {% if show_footers %}
                    {% render_footer %}
                {% endif %}
                <p class='footer__copyright'>{% translate "Â© The Internet of Good Things" %}</p>
            </div>

        </div>

    </div>
         {% if request.user.is_authenticated and notification_preference.receive_notifications == None  %}
                <div id="notif-banner"  style="
  position: fixed;
  bottom: 20px;
  left: 20px;
  background: #f1f1f1;
  padding: 15px 20px;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  z-index: 9999;">
                  <p>Would you like to enable desktop notifications?</p>
                  <button onclick="setNotificationPref('yes')">Yes</button>
                  <button onclick="setNotificationPref('no')">No</button>
                </div>
            {% endif %}
</footer>
<script>
function setNotificationPref(choice) {
    alert(choice)
  fetch("{% url 'save_notification_preference' %}", {
    method: "POST",
    headers: {
      "X-CSRFToken": "{{ csrf_token }}",
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ choice: choice }),
  }).then((res) => {
    if (res.ok) {
        console.log('response', res)
      document.getElementById("notif-banner").style.display = "none";
    }
  });
}
</script>