{% extends 'account/base.html' %}
{% load i18n static image_tags generic_components %}

{% block title %}{% translate "Profile" %}{% endblock %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css"
          href="{% static 'css/user-profile.css' %}">
{% endblock %}

{% block allauth_content %}
    {% if user.username %}
        <h1 class="title profile__title">
            {% blocktranslate trimmed with username=user.username %}
                Hey, {{ username }}
            {% endblocktranslate %}
            <span class="profile__icon">{{ user.username | first | upper }}</span>
        </h1>
 {% endif %}
     {# Show notification banner only if preference is not yet set #}
    <div class="profile__btns">
        {% url 'notification_settings' as notify_url %}
        {% primary_button title='Notification Preference' href=notify_url icon_path='icons/bell-solid.svg' extra_classnames='notification-pref-btn' %}
        {% url 'quiz_results' as quiz_result %}
            {% primary_button title='My Quiz Results' href=quiz_result icon_path='icons/quiz-answer-banner.svg' extra_classnames='notification-pref-btn' %}
        {% url 'my_activity' as activity_url %}
            {% primary_button title='My Activity' href=activity_url icon_path='icons/chat.svg' extra_classnames='notification-pref-btn' %}
        {% url 'user_profile_edit' as profile_edit %}
            {% primary_button title='Edit Profile' href=profile_edit icon_path='icons/profile.svg' extra_classnames='notification-pref-btn' %}
        <div data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
            {% url 'delete_account' as delete_account %}
            {% primary_button title='Delete Account' href='#' icon_path='icons/profile.svg' extra_classnames='notification-pref-btn' %}
        </div>
            {% url 'account_change_password' as change_password_url %}
        {% primary_button title='Change Digital Pin' href=change_password_url icon_path='icons/lock.svg' extra_classnames='change-digital-pin' %}
        {% url 'account_logout' as logout_url %}
        {% primary_button title='Log out' href=logout_url icon_path='icons/arrow_icon_left.svg' extra_classnames='logout-btn' %}
    </div>

{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="{% url 'delete_account' %}">
                    {% csrf_token %}
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteAccountModalLabel">Confirm Account Deletion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
            <div class="modal-body">
                <p class="mb-0">
                    This will permanently delete your <strong>profile</strong>, <strong>quiz results</strong>, and all related data.
                </p>
                <p class="mt-2 text-danger fw-semibold">
                    ⚠️ This action cannot be undone.
                </p>
            </div>
            <div class="modal-footer d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-danger">Yes, Delete My Account</button>
            </div>

                </form>
            </div>
        </div>
    </div>
{% endblock %}